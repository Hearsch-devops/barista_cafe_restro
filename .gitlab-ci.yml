stages:
  - deploy

deploy_to_kubernetes:
  image: alpine/k8s:1.27.4
  script:
    - kubectl apply --validate=false --insecure-skip-tls-verify -f backend-deployment.yaml
  tags:
    - k8s
    - local
  stage: deploy
  before_script:
    - echo "$KUBECONFIG" > kubeconfig
    - export KUBECONFIG=$CI_PROJECT_DIR/kubeconfig
  script:
    - kubectl version --client
    - kubectl apply -f backend-deployment.yaml
    - kubectl apply -f frontend-deployment.yaml
  only:
    - main
